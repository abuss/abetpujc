<!doctype html>
<head>
  <title>ABET - Facultad de Ingeniería</title>
  <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
  <script src="http://code.jquery.com/jquery-1.8.2.js"></script>
  <script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
  <script>
  var sumarCeldas = function(event) {
    event = event || window.event;
    var numfilas = document.getElementById('tabla').getElementsByTagName('tr').length;

    // Suma de cada columna
    {% for entry in entries.resprog %}
      var total = 0;
      for (k=1; k<numfilas-3; k++)
      {
        total = total + Number($("#tabla").find("#{{ entry[0] }}"+String(k))[0].value);
      }
      document.getElementById('suma{{ entry[0] }}').innerText = total;
    {% endfor %}

    // Suma de cada fila
    for (k=1; k<numfilas-3; k++)
    {
      var total = 0
      {% for entry in entries.resprog %}
          + Number($("#tabla").find("#{{ entry[0] }}"+String(k))[0].value)
      {% endfor %};
      document.getElementById('fila'+String(k)).innerText = total;
    }

    // Suma de los totales
    var total = 0
    for (k=1; k<numfilas-3; k++)
    {
      total = total + Number(document.getElementById('fila'+String(k)).innerText);
    }
    document.getElementById('totalsuma').innerText = total;

    // Calculo del objetivo
    {% for entry in entries.resprog %}
      var total = Number(document.getElementById('totalsuma').innerText)*{{ entry[1] }}/{{ entries.suma }};
      document.getElementById('objetivo{{ entry[0] }}').innerText = parseInt(total,10);
    {% endfor %}

    // Calculo de la diferencia
    {% for entry in entries.resprog %}
      var total = Number(document.getElementById('suma{{ entry[0] }}').innerText) - Number(document.getElementById('objetivo{{ entry[0] }}').innerText);
      document.getElementById('diferencia{{ entry[0] }}').innerText = parseInt(total,10);
    {% endfor %}
  };
  </script>
  <script>
  var sumarPorcentajes = function(event) {
    event = event || window.event;
    var numfilas = document.getElementById('tabla').getElementsByTagName('tr').length;
    var total = 0
    for (k=1; k<numfilas-3; k++)
    {
      total = total + Number($("#tabla").find("#porcentaje"+String(k))[0].value);
    }
    document.getElementById('porcentajetotal').innerText = String(total)+'%';
  };
  </script>
  <script>
  var paraCargar = function(event) {
    event = event || window.event;
    sumarCeldas(event);
    sumarPorcentajes(event);
  };
  </script>
  <script>
    $(function(){
      $("#botonadd").click(function(){
        var numfilas = document.getElementById('tabla').getElementsByTagName('tr').length;
        var htmlToAppend = "<tr><td><input type=text name='evaluacion"+String(numfilas-3)+"' id='evaluacion"+String(numfilas-3)+"'></td><td><input type='number' step='1' min='0' max='100' name='porcentaje"+String(numfilas-3)+"' id='porcentaje"+String(numfilas-3)+"' onchange='sumarPorcentajes()' size='3'></td><td width='150'>&nbsp;</td>{% for j in range(0,entries.conteo) %}<td><input type='number' step='1' min='0' max='100' name='{{ entries.resprog[j][0] }}"+String(numfilas-3)+"' id ='{{ entries.resprog[j][0] }}"+String(numfilas-3)+"'onchange='sumarCeldas()' size='3'></td>{% endfor %}<td align='center'><div id='fila"+String(numfilas-3)+"'>0</div></td></tr>";
        $("#tabla > tbody > tr").eq(numfilas-3).before(htmlToAppend);
        numfilas = numfilas + 1;
      });
      $("#botondel").click(function(){
        var numfilas = document.getElementById('tabla').getElementsByTagName('tr').length;
        if(numfilas>5)
        {
          $("#tabla tr:nth-last-of-type(4)").remove();
          numfilas = numfilas - 1;
        }
        paraCargar();
      });
    });
  </script>
</head>

<body {% if entries.numevals>0 %}onload="paraCargar()"{% endif %}>
<div class=page>
  {% block body %}
  <table>
  <tr>
    <td><img src="../../static/logo.png"></td>
    <td width="20">&nbsp;</td>
    <td><h4>Facultad de Ingeniería<br>Ingeniería de Sistemas y Computación</h4></td>
  </tr>
  </table>
  <h1>PROCESO DE ACREDITACIÓN INTERNACIONAL ABET</h1>
  <hr>
  <h4>{{ entries.detalles[0] }} - Grupo {{ entries.detalles[2] }}</h4>
  <h4>Período {{ entries.detalles[3] }}</h4>
  <br>
  <h5>Definición de Evaluaciones</h5>
  <br>

  <form name="forma" id="forma" action="{{ url_for('guardarPesos', codigo=entries.detalles[1], grupo=entries.detalles[2])}}" method=post>
  <table name="tabla" id="tabla" border="0">
    <tr>
      <td>Instrumento</td>
      <td align="center">%</td>
      <td width="50">&nbsp;</td>
      {% for entry in entries.resprog %}
        <td align="center">{{ entry[0] }}</td>
      {% endfor %}
      <td align="center">Total (%)</td>
    </tr>
    {% if entries.numevals>0 %}
      {% for k in range(1,entries.numevals+1) %}
        <tr>
          <td><input type=text name="evaluacion{{k}}" id="evaluacion{{k}}" value='{{ entries.evaluaciones[(k-1)*entries.conteo][0] }}'></td>
          <td><input type="number" step="1" min="0" max="100" name="porcentaje{{k}}" id="porcentaje{{k}}" onchange="sumarPorcentajes()" size="3" value='{{ entries.evaluaciones[(k-1)*entries.conteo][1] }}'></td>
          <td width="150">&nbsp;</td>
          {% for j in range(0,entries.conteo) %}
            <td><input type="number" step="1" min="0" max="100" name="{{ entries.resprog[j][0] }}{{k}}" id="{{ entries.resprog[j][0] }}{{k}}" onchange="sumarCeldas()" size="3" value='{{ entries.evaluaciones[((k-1)*entries.conteo)+j][3] }}'></td>
          {% endfor %}
          <td align="center"><div id="fila{{k}}">0</div></td>
        </tr>
      {% endfor %}
    {% else %}
      <tr>
        <td><input type=text name="evaluacion{{k}}"></td>
        <td><input type="number" step="1" min="0" max="100" name="porcentaje{{k}}" onchange="sumarPorcentajes()" size="3"></td>
        <td width="150">&nbsp;</td>
        {% for j in range(0,entries.conteo) %}
          <td><input type="number" step="1" min="0" max="100" name="{{ entries.resprog[j][0] }}{{k}}" onchange="sumarCeldas()" size="3"></td>
        {% endfor %}
        <td align="center"><div id="fila{{k}}">0</div></td>
      </tr>
    {% endif %}
    <tr>
      <td align="right">Total</td>
      <td align="center"><div id="porcentajetotal">0%</div></td>
      <td align="right">Suma:</td>
      {% for entry in entries.resprog %}
        <td align="center"><div id="suma{{ entry[0] }}">0</div></td>
      {% endfor %}
      <td align="center"><div id="totalsuma">0</div></td>
    </tr>
    <tr>
      <td align="right"></td>
      <td align="center"></td>
      <td align="right">Objetivo:</td>
      {% for entry in entries.resprog %}
        <td align="center"><div id="objetivo{{ entry[0] }}">0</div></td>
      {% endfor %}
    </tr>
    <tr>
      <td align="left">  <input type="button" id="botonadd" value="+"><input type="button" id="botondel" value="-"></td>
      <td align="center"></td>
      <td align="right">Diferencia:</td>
      {% for entry in entries.resprog %}
        <td align="center"><div id="diferencia{{ entry[0] }}">0</div></td>
      {% endfor %}
    </tr>
  </table>
  <br>
  <br>
  <input type=submit value='Guardar'>
  </form>
  <form name="botonseguir" action="{{ url_for('evaluaciones', codigo=entries.detalles[1], grupo=entries.detalles[2])}}">
  <input type=submit value='Definir los detalles de los Instrumentos'>
  </form>
  <form name="botonvolver" action="{{ url_for('asignatura', codigo=entries.detalles[1], grupo=entries.detalles[2])}}">
  <input type=submit value='Volver a {{entries.detalles[0]}}'>
  </form>
  {% endblock %}
</div>
</body>
